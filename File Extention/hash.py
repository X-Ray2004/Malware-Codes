import zipfile
import os
import json
import csv
from hashid import HashID

def extract_zip(zip_path, extract_to='.'):
    with zipfile.ZipFile(zip_path, 'r') as zip_ref:
        zip_ref.extractall(extract_to)
        return zip_ref.namelist()

def identify_hash_in_text(file_path):
    with open(file_path, 'r') as file:
        for line in file:
            yield line.strip()

def identify_hash_in_csv(file_path):
    with open(file_path, 'r') as file:
        reader = csv.reader(file)
        for row in reader:
            for item in row:
                yield item.strip()

def identify_hash_in_json(file_path):
    with open(file_path, 'r') as file:
        data = json.load(file)
        for item in parse_json(data):
            yield item

def parse_json(data):
    if isinstance(data, dict):
        for key, value in data.items():
            if isinstance(value, (dict, list)):
                yield from parse_json(value)
            else:
                yield str(value).strip()
    elif isinstance(data, list):
        for item in data:
            yield from parse_json(item)
    else:
        yield str(data).strip()

def identify_hash(file_path):
    hashid = HashID()
    file_extension = os.path.splitext(file_path)[1].lower()
    if file_extension == '.txt':
        lines = identify_hash_in_text(file_path)
    elif file_extension == '.csv':
        lines = identify_hash_in_csv(file_path)
    elif file_extension == '.json':
        lines = identify_hash_in_json(file_path)
    else:
        print(f"Unsupported file format: {file_extension}")
        return

    for line in lines:
        if line:
            results = hashid.identify(line)
            if results:
                print(f"Hash: {line}")
                for result in results:
                    print(f" - Algorithm: {result.name}")
            else:
                print(f"Unrecognized hash: {line}")

def main(zip_path, extract_to='.'):
    extracted_files = extract_zip(zip_path, extract_to)
    for file_name in extracted_files:
        file_path = os.path.join(extract_to, file_name)
        if os.path.isfile(file_path):
            print(f"\nProcessing file: {file_path}")
            identify_hash(file_path)

if __name__ == "__main__":
    zip_path = 'path_to_your_zip_file.zip'  # Update with the path to your ZIP file
    main(zip_path)
